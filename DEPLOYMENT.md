# Deployment Guide - Render

This guide explains how to deploy the School Management API to Render using Docker.

## Prerequisites

1. GitHub account with your code pushed to a repository
2. Render account (free tier available)
3. Docker knowledge (basic)

## Deployment Steps

### Option 1: Automatic Deployment with render.yaml

1. **Push your code to GitHub** including all the Docker files created
2. **Connect to Render**:
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New +" → "Web Service"
   - Connect your GitHub repository
3. **Render will automatically detect** the `render.yaml` file and configure the service
4. **Deploy** - Render will build and deploy automatically

### Option 2: Manual Configuration

1. **Create Web Service**:
   - Go to Render Dashboard
   - Click "New +" → "Web Service"
   - Connect your GitHub repository

2. **Configure Service**:
   ```
   Name: school-management-api
   Environment: Docker
   Region: Oregon (or your preferred region)
   Branch: main
   Dockerfile Path: ./Dockerfile.render
   ```

3. **Environment Variables**:
   ```
   APP_ENV=production
   APP_DEBUG=false
   APP_KEY=<auto-generated>
   APP_URL=https://your-service-name.onrender.com
   DB_CONNECTION=sqlite
   DB_DATABASE=/var/www/html/database/database.sqlite
   LOG_LEVEL=error
   SESSION_DRIVER=database
   CACHE_STORE=database
   QUEUE_CONNECTION=database
   ```

4. **Advanced Settings**:
   ```
   Health Check Path: /api/documentation
   ```

## File Structure for Deployment

```
project/
├── Dockerfile                 # Main Dockerfile
├── Dockerfile.render         # Optimized for Render
├── render.yaml              # Render configuration
├── docker-compose.yml       # Local development
├── .dockerignore           # Docker ignore file
├── .env.production         # Production environment template
└── docker/
    ├── apache/
    │   └── 000-default.conf # Apache virtual host
    ├── nginx/
    │   └── default.conf     # Nginx proxy (optional)
    └── startup.sh          # Application startup script
```

## Environment Variables

### Required
- `APP_KEY` - Auto-generated by Render
- `APP_URL` - Your Render service URL

### Optional (with defaults)
- `APP_ENV=production`
- `APP_DEBUG=false`
- `DB_CONNECTION=sqlite`
- `LOG_LEVEL=error`

## Post-Deployment

### 1. Verify Deployment
Visit your service URL:
```
https://your-service-name.onrender.com/api/documentation
```

### 2. Test API Endpoints
```bash
# Get API documentation
curl https://your-service-name.onrender.com/api/documentation

# Test login
curl -X POST https://your-service-name.onrender.com/api/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@greenwood.edu","password":"password123"}'
```

### 3. Sample Credentials
The seeded database includes:
- **Admin**: `admin@greenwood.edu` / `password123`
- **Teacher**: `mary@greenwood.edu` / `password123`
- **Student**: `alice@student.greenwood.edu` / `password123`

## Troubleshooting

### Common Issues

1. **Build Fails**:
   - Check Dockerfile syntax
   - Ensure all required files are committed to Git
   - Check build logs in Render dashboard

2. **App Won't Start**:
   - Check environment variables
   - Review application logs
   - Verify database permissions

3. **Database Issues**:
   - SQLite file permissions
   - Storage directory permissions
   - Migration failures

### Logs
Access logs in Render Dashboard:
- Go to your service
- Click "Logs" tab
- Monitor real-time logs

### Health Checks
The service includes a health check at `/api/documentation`:
- Returns 200 if healthy
- Render will restart if unhealthy

## Scaling

### Free Tier Limitations
- Service sleeps after 15 minutes of inactivity
- 750 hours/month limit
- Shared resources

### Paid Plans
- Always-on services
- More resources
- Custom domains
- SSL certificates

## Security Considerations

1. **Environment Variables**: Never commit sensitive data
2. **HTTPS**: Render provides free SSL
3. **Database**: SQLite is suitable for small-medium apps
4. **Logs**: Set `LOG_LEVEL=error` in production

## Monitoring

### Built-in Monitoring
- Render provides basic metrics
- Health check monitoring
- Automatic restarts

### Custom Monitoring
Consider adding:
- Application performance monitoring
- Error tracking (Sentry, Bugsnag)
- Uptime monitoring

## Backup Strategy

### SQLite Database
- Database is stored in container
- Consider external storage for persistence
- Regular backups recommended

### Recommended Approach
For production, consider:
- PostgreSQL addon from Render
- External database service
- Regular automated backups

## Cost Optimization

### Free Tier
- Use for development/testing
- Service sleeps when inactive
- Limited resources

### Production
- Starter plan: $7/month
- Always-on service
- Better performance
- Custom domains